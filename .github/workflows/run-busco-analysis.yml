name: Run BUSCO Analysis

on:
  workflow_dispatch:
    inputs:
      limit:
        description: 'Number of annotations to process (default: 3)'
        required: false
        default: '3'

permissions:
  contents: write

jobs:
  busco-analysis:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          
      - name: Set up Conda
        uses: conda-incubator/setup-miniconda@v3
        with:
          auto-update-conda: true
          python-version: '3.11'
          miniforge-version: latest
          channels: conda-forge,bioconda
          channel-priority: strict
          use-mamba: true
          
      - name: Install annocli
        run: |
          echo "Installing annocli"
          git clone https://github.com/apollo994/annocli.git
          pip install -e annocli/
          
      - name: Install AGAT and BUSCO via conda
        shell: bash -el {0}
        run: |
          echo "Installing agat and busco"
          mamba install -y -c conda-forge -c bioconda \
            "agat==1.6.1" \
            "busco==6.0.0"
          
          echo "Verifying installations..."
          agat_sp_keep_longest_isoform.pl --version
          agat_sp_extract_sequences.pl --version
          busco --version
          
